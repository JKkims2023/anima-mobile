Connecting to "@ecofriends/idol-champanion:main/idol-companion" ...
2025-12-28 20:34:00    â–² Next.js 15.5.9
2025-12-28 20:34:00    - Local:        http://localhost:3000
2025-12-28 20:34:00    - Network:      http://0.0.0.0:3000
2025-12-28 20:34:00 
2025-12-28 20:34:00  âœ“ Starting...
2025-12-28 20:34:00  âœ“ Ready in 206ms
2025-12-28 20:34:01 [SSE] ğŸ”§ Initialized global eventEmitters Map
2025-12-28 20:34:23 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-28 20:34:23 ğŸ“œ [Chat History] Fetching history
2025-12-28 20:34:23    user_key: d111e3d8-4e42-4493-8541-25a8e72b654f
2025-12-28 20:34:23    persona_key: c4136055-9d1b-4db4-9a09-f262fc47e923
2025-12-28 20:34:23    limit: 100, offset: 0
2025-12-28 20:34:23 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-28 20:34:23 ğŸ [Gift API] Getting pending gifts...
2025-12-28 20:34:23    User: d111e3d8-4e42-4493-8541-25a8e72b654f
2025-12-28 20:34:23    Persona: c4136055-9d1b-4db4-9a09-f262fc47e923
2025-12-28 20:34:23 âœ… [Gift API] Found 1 pending gift(s)
2025-12-28 20:34:23 âœ… [Chat History] Loaded 100 messages (fetched: 100, total: 108, filtered: 0)
2025-12-28 20:35:02 
2025-12-28 20:35:02 ğŸ¤– [ANIMA Chat] Request received
2025-12-28 20:35:02    User: d111e3d8-4e42-4493-8541-25a8e72b654f
2025-12-28 20:35:02    Session: session-1766921702217-4mn7po
2025-12-28 20:35:02    Message: ë‚˜ ë°°ê°€ ê³ íŒŒ ã…œã…œ ë‚˜ë¥¼ìœ„í•´ ì €ë… ë©”ë‰´ë¡œ ì¼ë³¸ ìŒì‹ ì¶”ì²œ í•´ì¤„ë˜?...
2025-12-28 20:35:02 âš ï¸  [SessionManager] Redis not available, using DB directly
2025-12-28 20:35:02 ğŸ”„ [SessionManager] Loading session from DB: d111e3d8-4e42-4493-8541-25a8e72b654f/session-1766921702217-4mn7po
2025-12-28 20:35:02 âœ… [SessionManager] Created new session: session-1766921702217-4mn7po
2025-12-28 20:35:02 âœ… [SessionManager] Session loaded from DB: d111e3d8-4e42-4493-8541-25a8e72b654f/session-1766921702217-4mn7po
2025-12-28 20:35:02    - Messages: 0
2025-12-28 20:35:02    - Persona: í™”ë‚´ëŠ” ê¹€ëŒ€í‘œë‹˜
2025-12-28 20:35:02    - Identity: Set (í…Œí† ë‚¨)
2025-12-28 20:35:02    - Preferences: Yes
2025-12-28 20:35:02 ğŸ“Š [SessionManager] Conversation stats: {
2025-12-28 20:35:02   totalMessages: 0,
2025-12-28 20:35:02   totalChars: 0,
2025-12-28 20:35:02   estimatedTokens: 0,
2025-12-28 20:35:02   averageMessageLength: NaN
2025-12-28 20:35:02 }
2025-12-28 20:35:02 ğŸ”„ [Sliding Window] Processing 0 messages
2025-12-28 20:35:02    Window size: 20
2025-12-28 20:35:02    Summarize threshold: 30
2025-12-28 20:35:02 âœ… [Sliding Window] Short conversation, keeping all 0 messages
2025-12-28 20:35:02 âœ… [ANIMA Chat] Session loaded
2025-12-28 20:35:02    Total messages: 0
2025-12-28 20:35:02    Kept messages: 0
2025-12-28 20:35:02    Summarized messages: 0
2025-12-28 20:35:02    Sliding window: Inactive
2025-12-28 20:35:02    Persona: í™”ë‚´ëŠ” ê¹€ëŒ€í‘œë‹˜
2025-12-28 20:35:02    Preferences: Custom
2025-12-28 20:35:02 ğŸ¯ [ANIMA Chat] AI Strategy selected
2025-12-28 20:35:02    Tier: free
2025-12-28 20:35:02    Model: GPT-4o Mini
2025-12-28 20:35:02    Provider: openai
2025-12-28 20:35:02    Caching: Enabled
2025-12-28 20:35:02 [VectorSync] Searching for: "ë‚˜ ë°°ê°€ ê³ íŒŒ ã…œã…œ ë‚˜ë¥¼ìœ„í•´ ì €ë… ë©”ë‰´ë¡œ ì¼ë³¸ ìŒì‹ ì¶”ì²œ í•´ì¤„ë˜?"
2025-12-28 20:35:05 [VectorSync] Found 3 relevant knowledge items
2025-12-28 20:35:05 ğŸ” [ANIMA Chat] Found 3 relevant knowledge items
2025-12-28 20:35:05    1. ANIMAë¡œ í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤ (similarity: 21.9%)
2025-12-28 20:35:05    2. ê³µê°ì˜ ê¸°ë³¸ ì›ì¹™ (similarity: 19.8%)
2025-12-28 20:35:05    3. ìì‚´/ìí•´ ìœ„í—˜ ëŒ€ì‘ í”„ë¡œí† ì½œ (similarity: 19.8%)
2025-12-28 20:35:05 ğŸ”¥ [ANIMA Chat] Building EMOTIONAL EMPATHY prompt for User Persona...
2025-12-28 20:35:05 ğŸ”¥ [EmotionalPrompt] Building for í…Œí† ë‚¨
2025-12-28 20:35:05 âœ… [EmotionalPrompt] Built: 17027 chars
2025-12-28 20:35:05 ğŸ“ [ANIMA Chat] System prompt built (18713 chars, 3 knowledge items)
2025-12-28 20:35:05 ğŸš€ [ANIMA Chat] Calling AI with Prompt Caching...
2025-12-28 20:35:05    Provider: openai
2025-12-28 20:35:05    Model: gpt-4o-mini
2025-12-28 20:35:05    History messages: 0
2025-12-28 20:35:05    System prompt length: 18713 chars
2025-12-28 20:35:05 ğŸ› ï¸ [Function Calling] Enabled for user-created persona
2025-12-28 20:35:05 ğŸ¤– [OpenAI] Calling API: {
2025-12-28 20:35:05   model: 'gpt-4o-mini',
2025-12-28 20:35:05   messageCount: 2,
2025-12-28 20:35:05   systemPromptLength: 18713,
2025-12-28 20:35:05   historyLength: 0,
2025-12-28 20:35:05   toolsEnabled: true
2025-12-28 20:35:05 }
2025-12-28 20:35:08 âœ… [OpenAI] Response received: {
2025-12-28 20:35:08   responseTime: '3249ms',
2025-12-28 20:35:08   tokens: { prompt: 7083, completion: 110, total: 7193 },
2025-12-28 20:35:08   messageLength: 0,
2025-12-28 20:35:08   finishReason: 'tool_calls',
2025-12-28 20:35:08   toolCalls: 1
2025-12-28 20:35:08 }
2025-12-28 20:35:08 ğŸ› ï¸ [Function Calling] AI requested 1 tool(s)
2025-12-28 20:35:08 ğŸ› ï¸ [Function Calling] Executing: generate_chat_content
2025-12-28 20:35:08    Args: {
2025-12-28 20:35:08   content_type: 'image',
2025-12-28 20:35:08   scene_description: 'ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ì¼ë³¸ ìŒì‹ì ì—ì„œ ë§›ìˆëŠ” ì´ˆë°¥ì„ ì¦ê¸°ëŠ” ëª¨ìŠµ. ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì´ˆë°¥ì´ ì˜ˆì˜ê²Œ ë‹´ê²¨ìˆê³ , ê°„ì¥ê³¼ ì™€ì‚¬ë¹„ê°€ í•¨ê»˜ ë†“ì—¬ ìˆë‹¤. ë”°ëœ»í•œ ì¡°ëª… ì•„ë˜ì—ì„œ í–‰ë³µí•œ í‘œì •ì„ ì§“ê³  ìˆë‹¤.',
2025-12-28 20:35:08   ai_reasoning: 'User is hungry and wants Japanese food for dinner. Visual will help them decide.',
2025-12-28 20:35:08   expect_announcement: true
2025-12-28 20:35:08 }
2025-12-28 20:35:08 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-28 20:35:08 ğŸ¨ [Tool] generate_chat_content
2025-12-28 20:35:08    Type: image
2025-12-28 20:35:08    Scene: ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ì¼ë³¸ ìŒì‹ì ì—ì„œ ë§›ìˆëŠ” ì´ˆë°¥ì„ ì¦ê¸°ëŠ” ëª¨ìŠµ. ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì´ˆë°¥ì´ ì˜ˆì˜ê²Œ ë‹´ê²¨ìˆê³ , ê°„ì¥ê³¼ ì™€ì‚¬ë¹„ê°€ í•¨ê»˜ ë†“ì—¬ ìˆë‹¤. ë”°ëœ»í•œ ì¡°ëª… ì•„ë˜ì—ì„œ í–‰ë³µí•œ í‘œì •ì„ ì§“ê³  ìˆë‹¤.
2025-12-28 20:35:08    Reasoning: User is hungry and wants Japanese food for dinner. Visual will help them decide.
2025-12-28 20:35:08 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-28 20:35:08 âœ… [Function Calling] Result: {
2025-12-28 20:35:08   success: true,
2025-12-28 20:35:08   content_type: 'image',
2025-12-28 20:35:08   scene_description: 'ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ì¼ë³¸ ìŒì‹ì ì—ì„œ ë§›ìˆëŠ” ì´ˆë°¥ì„ ì¦ê¸°ëŠ” ëª¨ìŠµ. ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì´ˆë°¥ì´ ì˜ˆì˜ê²Œ ë‹´ê²¨ìˆê³ , ê°„ì¥ê³¼ ì™€ì‚¬ë¹„ê°€ í•¨ê»˜ ë†“ì—¬ ìˆë‹¤. ë”°ëœ»í•œ ì¡°ëª… ì•„ë˜ì—ì„œ í–‰ë³µí•œ í‘œì •ì„ ì§“ê³  ìˆë‹¤.',
2025-12-28 20:35:08   ai_reasoning: 'User is hungry and wants Japanese food for dinner. Visual will help them decide.',
2025-12-28 20:35:08   expect_announcement: true,
2025-12-28 20:35:08   message: 'ì»¨í…ì¸  ìƒì„±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìì—ê²Œ ìƒì„± ì¤‘ì„ì„ ì•Œë ¤ì£¼ì„¸ìš”.',
2025-12-28 20:35:08   _chat_content_generation: true
2025-12-28 20:35:08 }
2025-12-28 20:35:08 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-28 20:35:08 ğŸ¨ [Chat Content] AI requested content generation!
2025-12-28 20:35:08    Type: image
2025-12-28 20:35:08    Scene: ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ì¼ë³¸ ìŒì‹ì ì—ì„œ ë§›ìˆëŠ” ì´ˆë°¥ì„ ì¦ê¸°ëŠ” ëª¨ìŠµ. ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì´ˆë°¥ì´ ì˜ˆì˜ê²Œ ë‹´ê²¨ìˆê³ , ê°„ì¥ê³¼ ì™€ì‚¬ë¹„ê°€ í•¨ê»˜ ë†“ì—¬ ìˆë‹¤. ë”°ëœ»í•œ ì¡°ëª… ì•„ë˜ì—ì„œ í–‰ë³µí•œ í‘œì •ì„ ì§“ê³  ìˆë‹¤.
2025-12-28 20:35:08 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-28 20:35:08 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-28 20:35:08 ğŸ¨ [ContentGenerator] Creating request...
2025-12-28 20:35:08    ID: f13852c1-4936-4cde-8099-4959cd22fbf0
2025-12-28 20:35:08    Type: image
2025-12-28 20:35:08    Scene: ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ì¼ë³¸ ìŒì‹ì ì—ì„œ ë§›ìˆëŠ” ì´ˆë°¥ì„ ì¦ê¸°ëŠ” ëª¨ìŠµ. ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì´ˆë°¥ì´ ì˜ˆì˜ê²Œ ë‹´ê²¨ìˆê³ , ê°„ì¥ê³¼ ì™€ì‚¬ë¹„ê°€ í•¨ê»˜ ë†“ì—¬ ìˆë‹¤. ë”°ëœ»í•œ ì¡°ëª… ì•„ë˜ì—ì„œ í–‰ë³µí•œ í‘œì •ì„ ì§“ê³  ìˆë‹¤.
2025-12-28 20:35:08 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-28 20:35:08 âœ… [ContentGenerator] Request created: f13852c1-4936-4cde-8099-4959cd22fbf0
2025-12-28 20:35:08 ğŸ¨ [ImageGenerator] Starting generation...
2025-12-28 20:35:08    Content ID: f13852c1-4936-4cde-8099-4959cd22fbf0
2025-12-28 20:35:08    Persona Image: https://babi-cdn.logbrix.ai/babi/real/babi/2898474a-2cdc-42f1-950d-d06abc406540_00001_.png
2025-12-28 20:35:08    Prompt: ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ì¼ë³¸ ìŒì‹ì ì—ì„œ ë§›ìˆëŠ” ì´ˆë°¥ì„ ì¦ê¸°ëŠ” ëª¨ìŠµ. ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì´ˆë°¥ì´ ì˜ˆì˜ê²Œ ë‹´ê²¨ìˆê³ , ê°„ì¥ê³¼ ì™€ì‚¬ë¹„ê°€ í•¨ê»˜ ë†“ì—¬ ìˆë‹¤. ë”°ëœ»í•œ ì¡°ëª… ì•„ë˜ì—ì„œ í–‰ë³µí•œ í‘œì •ì„ ì§“ê³  ìˆë‹¤.
2025-12-28 20:35:08 âœ… [Chat Content] Generation started: f13852c1-4936-4cde-8099-4959cd22fbf0
2025-12-28 20:35:08 ğŸ”„ [Function Calling] Re-calling AI with tool results...
2025-12-28 20:35:08 ğŸ¤– [OpenAI] Calling API: {
2025-12-28 20:35:08   model: 'gpt-4o-mini',
2025-12-28 20:35:08   messageCount: 4,
2025-12-28 20:35:08   systemPromptLength: 18713,
2025-12-28 20:35:08   historyLength: 2,
2025-12-28 20:35:08   toolsEnabled: true
2025-12-28 20:35:08 }
2025-12-28 20:35:09 âœ… [OpenAI] Response received: {
2025-12-28 20:35:09   responseTime: '1091ms',
2025-12-28 20:35:09   tokens: { prompt: 7306, completion: 34, total: 7340 },
2025-12-28 20:35:09   messageLength: 54,
2025-12-28 20:35:09   finishReason: 'stop',
2025-12-28 20:35:09   toolCalls: 0
2025-12-28 20:35:09 }
2025-12-28 20:35:09 âœ… [Function Calling] Final AI response generated
2025-12-28 20:35:09 âœ… [ANIMA Chat] AI response received (no caching)
2025-12-28 20:35:09    Response time: 3249ms
2025-12-28 20:35:09    Total tokens: 14533 (in: 14389, out: 144)
2025-12-28 20:35:09 âš ï¸  [SessionManager] Redis not available, using DB directly
2025-12-28 20:35:09 ğŸ”„ [SessionManager] Loading session from DB: d111e3d8-4e42-4493-8541-25a8e72b654f/session-1766921702217-4mn7po
2025-12-28 20:35:09 âœ… [SessionManager] Session loaded from DB: d111e3d8-4e42-4493-8541-25a8e72b654f/session-1766921702217-4mn7po
2025-12-28 20:35:09    - Messages: 0
2025-12-28 20:35:09    - Persona: í™”ë‚´ëŠ” ê¹€ëŒ€í‘œë‹˜
2025-12-28 20:35:09    - Identity: Set (í…Œí† ë‚¨)
2025-12-28 20:35:09    - Preferences: Yes
2025-12-28 20:35:09 âš ï¸  [SessionManager] Redis not available, using DB directly
2025-12-28 20:35:09 ğŸ”„ [SessionManager] Loading session from DB: d111e3d8-4e42-4493-8541-25a8e72b654f/session-1766921702217-4mn7po
2025-12-28 20:35:09 ğŸ’¾ [SessionManager] Message saved: session-1766921702217-4mn7po (user)
2025-12-28 20:35:09 âœ… [SessionManager] Session loaded from DB: d111e3d8-4e42-4493-8541-25a8e72b654f/session-1766921702217-4mn7po
2025-12-28 20:35:09    - Messages: 1
2025-12-28 20:35:09    - Persona: í™”ë‚´ëŠ” ê¹€ëŒ€í‘œë‹˜
2025-12-28 20:35:09    - Identity: Set (í…Œí† ë‚¨)
2025-12-28 20:35:09    - Preferences: Yes
2025-12-28 20:35:09 ğŸ’¾ [ANIMA Chat] Messages saved to history (sequential)
2025-12-28 20:35:09 ğŸ‰ [ANIMA Chat] Request completed in 7774ms
2025-12-28 20:35:09    Cost: $0.002245
2025-12-28 20:35:10 ğŸ’¾ [SessionManager] Message saved: session-1766921702217-4mn7po (assistant)
2025-12-28 20:35:11 âœ… [ImageGenerator] Generation started
2025-12-28 20:35:11    Request Key: 6a444fe7-a56c-4bbd-88cf-90683f161ae8
2025-12-28 20:35:11    Estimated Time: 15s


chat_generated_content í…Œì´ë¸” ì •ë³´

f13852c1-4936-4cde-8099-4959cd22fbf0	d111e3d8-4e42-4493-8541-25a8e72b654f	c4136055-9d1b-4db4-9a09-f262fc47e923	session-1766921702217-4mn7po	image	ë‚˜ ë°°ê°€ ê³ íŒŒ ã…œã…œ ë‚˜ë¥¼ìœ„í•´ ì €ë… ë©”ë‰´ë¡œ ì¼ë³¸ ìŒì‹ ì¶”ì²œ í•´ì¤„ë˜?	User is hungry and wants Japanese food for dinner. Visual will help them decide.	ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ì¼ë³¸ ìŒì‹ì ì—ì„œ ë§›ìˆëŠ” ì´ˆë°¥ì„ ì¦ê¸°ëŠ” ëª¨ìŠµ. ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì´ˆë°¥ì´ ì˜ˆì˜ê²Œ ë‹´ê²¨ìˆê³ , ê°„ì¥ê³¼ ì™€ì‚¬ë¹„ê°€ í•¨ê»˜ ë†“ì—¬ ìˆë‹¤. ë”°ëœ»í•œ ì¡°ëª… ì•„ë˜ì—ì„œ í–‰ë³µí•œ í‘œì •ì„ ì§“ê³  ìˆë‹¤.	ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ì¼ë³¸ ìŒì‹ì ì—ì„œ ë§›ìˆëŠ” ì´ˆë°¥ì„ ì¦ê¸°ëŠ” ëª¨ìŠµ. ë‹¤ì–‘í•œ ìƒ‰ê¹”ì˜ ì´ˆë°¥ì´ ì˜ˆì˜ê²Œ ë‹´ê²¨ìˆê³ , ê°„ì¥ê³¼ ì™€ì‚¬ë¹„ê°€ í•¨ê»˜ ë†“ì—¬ ìˆë‹¤. ë”°ëœ»í•œ ì¡°ëª… ì•„ë˜ì—ì„œ í–‰ë³µí•œ í‘œì •ì„ ì§“ê³  ìˆë‹¤.		processing	6a444fe7-a56c-4bbd-88cf-90683f161ae8				0		0	2025-12-28 20:35:08	2025-12-28 20:35:11
f6999286-52a3-427e-9485-07d4a7e64f66	d111e3d8-4e42-4493-8541-25a8e72b654f	c4136055-9d1b-4db4-9a09-f262fc47e923	session-1766920513090-747rog	image	ë‚˜ ì˜¤ëŠ˜ ë°¥ì„ í•˜ë‚˜ë„ ëª»ë¨¹ì—ˆì–´...ã…œã…œ ë©”ë‰´ì¢€ ì¶”ì²œí•´ì¤„ë˜?!	User hasn't eaten anything today and needs food recommendations. Visual will help them decide.	ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ë”°ëœ»í•œ ê¹€ì¹˜ì°Œê°œë¥¼ ë¨¹ëŠ” ëª¨ìŠµ. í‘¸ì§í•œ ê³ ê¸°ì™€ ë‘ë¶€ê°€ ê°€ë“í•˜ê³ , ê¹€ì´ ëª¨ë½ëª¨ë½ ë‚˜ëŠ” ëšë°°ê¸°. ë”°ëœ»í•˜ê³  ì •ê²¨ìš´ ë¶„ìœ„ê¸°.	ì´ ì‚¬ì§„ ì† ì£¼ì¸ê³µì´ ë”°ëœ»í•œ ê¹€ì¹˜ì°Œê°œë¥¼ ë¨¹ëŠ” ëª¨ìŠµ. í‘¸ì§í•œ ê³ ê¸°ì™€ ë‘ë¶€ê°€ ê°€ë“í•˜ê³ , ê¹€ì´ ëª¨ë½ëª¨ë½ ë‚˜ëŠ” ëšë°°ê¸°. ë”°ëœ»í•˜ê³  ì •ê²¨ìš´ ë¶„ìœ„ê¸°.		failed				fetch failed	0		0	2025-12-28 20:15:20	2025-12-28 20:15:20

