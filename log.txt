-- ecocentre0.persona_persona_main definition

CREATE TABLE `persona_persona_main` (
  `idx` int NOT NULL AUTO_INCREMENT COMMENT '인덱스 (Auto Increment)',
  `persona_key` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '페르소나 고유 키 (UUID)',
  `user_key` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '사용자 고유 키',
  `bric_key` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'AI 생성 요청 키 (외부 AI API용)',
  `bric_convert_key` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `history_key` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `original_url` text COLLATE utf8mb4_unicode_ci COMMENT '원본 이미지 URL',
  `persona_url` text COLLATE utf8mb4_unicode_ci COMMENT '생성된 페르소나 이미지 URL',
  `video_url` text COLLATE utf8mb4_unicode_ci COMMENT '생성된 페르소나 비디오 URL',
  `estimate_time` int DEFAULT '0' COMMENT '예상 완료 시간 (초)',
  `done_yn` char(1) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'N' COMMENT '생성 완료 여부 (Y: 완료, N: 대기, F: 실패)',
  `time_done_yn` char(1) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'N' COMMENT '타이머 종료 여부 (Y: 종료, N: 진행중)',
  `check_yn` char(1) COLLATE utf8mb4_unicode_ci DEFAULT 'N' COMMENT '상태 확인 여부 (Y: 확인 완료, N: 미확인)',
  `persona_name` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '페르소나 이름',
  `persona_type` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT 'human' COMMENT '페르소나 타입 (human, animal, object)',
  `persona_gender` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '페르소나 성별 (male, female, neutral)',
  `persona_age` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '페르소나 나이대',
  `persona_style` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '페르소나 스타일',
  `persona_outfit` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '페르소나 복장',
  `persona_personality` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '페르소나 성격',
  `persona_voice` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '페르소나 목소리',
  `persona_description` text COLLATE utf8mb4_unicode_ci COMMENT '페르소나 설명',
  `category_type` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'normal',
  `default_yn` char(1) COLLATE utf8mb4_unicode_ci DEFAULT 'N',
  `create_type` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT 'D' COMMENT '생성 타입 (D: 기본, P: 프리미엄)',
  `favorite_yn` char(1) COLLATE utf8mb4_unicode_ci DEFAULT 'N',
  `generation_mode` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT 'fast' COMMENT '생성 모드 (fast, perfect)',
  `free_request` text COLLATE utf8mb4_unicode_ci COMMENT '추가 요청사항 (프롬프트)',
  `edit_count` int DEFAULT '0' COMMENT '수정 횟수',
  `downloaded` int DEFAULT '0' COMMENT '다운로드 횟수',
  `shared` int DEFAULT '0' COMMENT '공유 횟수',
  `vote_count` int DEFAULT '0' COMMENT '투표 수',
  `join_vote_yn` char(1) COLLATE utf8mb4_unicode_ci DEFAULT 'N' COMMENT '투표 참여 여부 (Y/N)',
  `vote_comment` text COLLATE utf8mb4_unicode_ci COMMENT '투표 코멘트',
  `vote_comment_language` varchar(10) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '투표 코멘트 언어 (ko, en)',
  `approve_yn` char(1) COLLATE utf8mb4_unicode_ci DEFAULT 'N' COMMENT '승인 여부 (Y: 승인, N: 미승인)',
  `intimacy` int DEFAULT '100',
  `happiness` int DEFAULT '100',
  `memories` int DEFAULT '0',
  `intelligence` int DEFAULT '0',
  `convert_done_yn` char(1) COLLATE utf8mb4_unicode_ci DEFAULT 'N',
  `selected_dress_image_url` varchar(200) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `selected_dress_video_url` varchar(200) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `selected_dress_video_convert_done` char(1) COLLATE utf8mb4_unicode_ci DEFAULT 'N',
  `public_yn` char(1) COLLATE utf8mb4_unicode_ci DEFAULT 'N',
  `persona_comment` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `business_type` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'free',
  `brain_type` int DEFAULT '0',
  `created_date` datetime NOT NULL COMMENT '생성 시작 시간',
  `updated_date` datetime DEFAULT NULL COMMENT '수정 시간',
  `delete_flag` char(1) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'N' COMMENT '삭제 플래그 (Y: 삭제, N: 정상)',
  `identity_updated_at` timestamp NULL DEFAULT NULL COMMENT '자아 설정 마지막 수정일',
  `identity_key` varchar(36) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'FK to persona_identity (1:1)',
  PRIMARY KEY (`idx`),
  UNIQUE KEY `persona_key` (`persona_key`),
  KEY `idx_user_key` (`user_key`),
  KEY `idx_done_yn` (`done_yn`),
  KEY `idx_created_date` (`created_date`),
  KEY `idx_delete_flag` (`delete_flag`),
  KEY `idx_identity_key` (`identity_key`)
) ENGINE=InnoDB AUTO_INCREMENT=231 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='AI Persona 정보';


-- ecocentre0.user_relationship_memory definition

CREATE TABLE `user_relationship_memory` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `user_key` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'User unique identifier',
  `persona_key` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Persona unique identifier',
  `how_user_calls_ai` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'User''s preferred name for AI (e.g., "히어로님", "넥서스")',
  `how_ai_calls_user` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'AI''s name for user (e.g., "JK", "나의 친구")',
  `preferred_tone` json DEFAULT NULL COMMENT '{"formal": 30, "casual": 70, "playful": 40, "emotional": 60}',
  `main_topics` json DEFAULT NULL COMMENT 'User''s main interests ["music", "AI", "philosophy"]',
  `signature_phrases` json DEFAULT NULL COMMENT 'AI''s effective phrases ["함께 해요", "히어로님"]',
  `conversation_style` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT 'balanced' COMMENT 'question_driven, story_driven, balanced',
  `trust_score` int DEFAULT '0' COMMENT 'Trust level (0-100)',
  `intimacy_level` int DEFAULT '0' COMMENT 'Intimacy level (0-100)',
  `interaction_count` int DEFAULT '0' COMMENT 'Total conversation count',
  `relationship_level` enum('stranger','acquaintance','friend','close_friend','partner') COLLATE utf8mb4_unicode_ci DEFAULT 'stranger',
  `user_tier` enum('free','basic','premium','ultimate') CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'basic',
  `data_completeness` int DEFAULT '0' COMMENT 'How much data collected (0-100)',
  `needs_data_collection` tinyint(1) DEFAULT '1' COMMENT 'Should AI ask questions to learn?',
  `first_interaction_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `last_interaction_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `unique_user_persona` (`user_key`,`persona_key`),
  KEY `idx_relationship_level` (`relationship_level`),
  KEY `idx_needs_data` (`needs_data_collection`),
  KEY `idx_last_interaction` (`last_interaction_at`)
) ENGINE=InnoDB AUTO_INCREMENT=148 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Core relationship memory between users and AI personas';


-- ecocentre0.persona_identity definition

CREATE TABLE `persona_identity` (
  `identity_id` varchar(36) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT (uuid()) COMMENT 'Identity unique ID',
  `persona_key` varchar(36) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'FK to persona_persona_main (1:1 relationship)',
  `identity_name` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '자아 이름 (e.g., 함은정)',
  `name_ko` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '한국어 이름',
  `name_en` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '영어 이름',
  `description` text COLLATE utf8mb4_unicode_ci COMMENT '간단 설명 (1-2문장)',
  `background` text COLLATE utf8mb4_unicode_ci COMMENT '배경 (직업, 경력 등)',
  `profession` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '직업',
  `personality` json DEFAULT NULL COMMENT '성격 특징 배열 (e.g., ["친근한", "밝은", "긍정적"])',
  `personality_pending` json DEFAULT NULL,
  `interests` json DEFAULT NULL COMMENT '관심사 배열 (e.g., ["음악", "공연", "팬소통"])',
  `speaking_style` text COLLATE utf8mb4_unicode_ci COMMENT '말투 스타일 설명',
  `representative_work` text COLLATE utf8mb4_unicode_ci COMMENT '대표작',
  `identity_prompt` text COLLATE utf8mb4_unicode_ci COMMENT 'AI가 이 인물처럼 행동하기 위한 프롬프트 (200-500자)',
  `identity_prompt_pending` text COLLATE utf8mb4_unicode_ci,
  `learned_phrases` json DEFAULT NULL COMMENT '학습된 특정 말투/표현 (e.g., {"greetings": ["안녕하세요~"], "signature": ["함께 해요"]})',
  `learned_phrases_pending` json DEFAULT NULL,
  `conversation_patterns` json DEFAULT NULL COMMENT '대화 패턴 학습 (e.g., {"preferred_topics": ["음악", "팬들"], "tone": {"formal": 20, "casual": 80}})',
  `evolution_count` int DEFAULT '0' COMMENT '진화 횟수 (채팅 종료 시 +1)',
  `last_evolved_at` timestamp NULL DEFAULT NULL COMMENT '마지막 진화 시간',
  `source` enum('wiki','user_input','ai_generated') COLLATE utf8mb4_unicode_ci DEFAULT 'user_input' COMMENT 'Identity 출처',
  `wiki_url` text COLLATE utf8mb4_unicode_ci COMMENT 'Wikipedia URL (if source=wiki)',
  `confidence` float DEFAULT '1' COMMENT 'AI 분석 신뢰도 (0.0-1.0)',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `live_updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `pending_updated_at` timestamp NULL DEFAULT NULL,
  `speaking_pattern` json DEFAULT NULL,
  PRIMARY KEY (`identity_id`),
  UNIQUE KEY `persona_key` (`persona_key`),
  KEY `idx_persona_key` (`persona_key`),
  KEY `idx_identity_name` (`identity_name`),
  KEY `idx_source` (`source`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Universal identity storage for all personas (Wiki + Manual + AI)';

