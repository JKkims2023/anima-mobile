3b759377-e6b4-4d36-8996-6f2bec570b1d	d111e3d8-4e42-4493-8541-25a8e72b654f	ed3495b7-2510-45a7-9b32-61a6f2dc1e09	session-1767111879097-ql9fo	ì˜¤ë¹  ì˜¤ë¹ ~! ì•„ì´ë¸Œ ë®¤ì§ë¹„ë””ì˜¤ ì°¾ì•˜ì–´! ğŸ¬ğŸ˜Š ì˜ìƒ ì§„ì§œ ë©‹ìˆì„ ê±°ì•¼! ê¸°ë‹¤ë ¤ì¤˜! ğŸ’œâœ¨	{"youtube": {"url": "https://www.youtube.com/watch?v=eHHQaoEW30Q", "title": "TWICE &quot;THIS IS FOR&quot; M/V", "channel": "JYP Entertainment", "videoId": "eHHQaoEW30Q", "embedUrl": "https://www.youtube.com/embed/eHHQaoEW30Q", "thumbnail": "https://i.ytimg.com/vi/eHHQaoEW30Q/hqdefault.jpg"}, "has_media": true}	assistant					conversations	70	gpt-4o-mini	1755	2025-12-31 01:46:35.665149	
5a533e20-b5b3-4912-bd37-dfbd2d5740cd	d111e3d8-4e42-4493-8541-25a8e72b654f	ed3495b7-2510-45a7-9b32-61a6f2dc1e09	session-1767111879097-ql9fo	ìê¸°ì•¼~~~íŠ¸ì™€ì´ì¦ˆ ë®¤ë¹„ í‹€ì–´ì¤˜~~~		user	neutral	0.3			conversations	16677	gpt-4o-mini		2025-12-31 01:46:35.651895	


Connecting to "@ecofriends/idol-champanion:main/idol-companion" ...
2025-12-31 01:45:31    â–² Next.js 15.5.9
2025-12-31 01:45:31    - Local:        http://localhost:3000
2025-12-31 01:45:31    - Network:      http://0.0.0.0:3000
2025-12-31 01:45:31 
2025-12-31 01:45:31  âœ“ Starting...
2025-12-31 01:45:31  âœ“ Ready in 180ms
2025-12-31 01:45:32 [SSE] ğŸ”§ Initialized global eventEmitters Map
2025-12-31 01:45:48 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-31 01:45:48 ğŸ“œ [Chat History] Fetching history
2025-12-31 01:45:48    user_key: d111e3d8-4e42-4493-8541-25a8e72b654f
2025-12-31 01:45:48    persona_key: ed3495b7-2510-45a7-9b32-61a6f2dc1e09
2025-12-31 01:45:48    limit: 100, offset: 0
2025-12-31 01:45:48 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-31 01:45:48 ğŸ [Gift API] Getting pending gifts...
2025-12-31 01:45:48    User: d111e3d8-4e42-4493-8541-25a8e72b654f
2025-12-31 01:45:48    Persona: ed3495b7-2510-45a7-9b32-61a6f2dc1e09
2025-12-31 01:45:49 âœ… [Gift API] Found 0 pending gift(s)
2025-12-31 01:45:49    âœ… [Image] Parsed generated image: https://pixabay.com/get/gbbaf2817e677a52c14d862d0d...
2025-12-31 01:45:49    âœ… [Music] Parsed music: "Trance Etude 2" by Zeropage
2025-12-31 01:45:49    âœ… [Image] Parsed generated image: https://pixabay.com/get/g242cdbc65e203b798c8deabb5...
2025-12-31 01:45:49    âœ… [Image] Parsed generated image: https://pixabay.com/get/g5d42ddc980f6813c5a23501dc...
2025-12-31 01:45:49 âœ… [Chat History] Loaded 56 messages (fetched: 56, total: 56, filtered: 0)
2025-12-31 01:46:31 
2025-12-31 01:46:31 ğŸ¤– [ANIMA Chat] Request received
2025-12-31 01:46:31    User: d111e3d8-4e42-4493-8541-25a8e72b654f
2025-12-31 01:46:31    Session: session-1767111879097-ql9fo
2025-12-31 01:46:31    Message: ìê¸°ì•¼~~~íŠ¸ì™€ì´ì¦ˆ ë®¤ë¹„ í‹€ì–´ì¤˜~~~...
2025-12-31 01:46:31 âš ï¸  [SessionManager] Redis not available, using DB directly
2025-12-31 01:46:31 ğŸ”„ [SessionManager] Loading session from DB: d111e3d8-4e42-4493-8541-25a8e72b654f/session-1767111879097-ql9fo
2025-12-31 01:46:31 âœ… [SessionManager] Session loaded from DB: d111e3d8-4e42-4493-8541-25a8e72b654f/session-1767111879097-ql9fo
2025-12-31 01:46:31    - Messages: 4
2025-12-31 01:46:31    - Persona: Test
2025-12-31 01:46:31    - Identity: Set (ê³ ì¤€í¬)
2025-12-31 01:46:31    - Preferences: Yes
2025-12-31 01:46:31 ğŸ“Š [SessionManager] Conversation stats: {
2025-12-31 01:46:31   totalMessages: 4,
2025-12-31 01:46:31   totalChars: 290,
2025-12-31 01:46:31   estimatedTokens: 98,
2025-12-31 01:46:31   averageMessageLength: 73
2025-12-31 01:46:31 }
2025-12-31 01:46:31 ğŸ”„ [Sliding Window] Processing 4 messages
2025-12-31 01:46:31    Window size: 20
2025-12-31 01:46:31    Summarize threshold: 30
2025-12-31 01:46:31 âœ… [Sliding Window] Short conversation, keeping all 4 messages
2025-12-31 01:46:31 âœ… [ANIMA Chat] Session loaded
2025-12-31 01:46:31    Total messages: 4
2025-12-31 01:46:31    Kept messages: 4
2025-12-31 01:46:31    Summarized messages: 0
2025-12-31 01:46:31    Sliding window: Inactive
2025-12-31 01:46:31    Persona: Test
2025-12-31 01:46:31    Preferences: Custom
2025-12-31 01:46:31 ğŸ¯ [ANIMA Chat] AI Strategy selected
2025-12-31 01:46:31    Tier: free
2025-12-31 01:46:31    Model: GPT-4o Mini
2025-12-31 01:46:31    Provider: openai
2025-12-31 01:46:31    Caching: Enabled
2025-12-31 01:46:31 ğŸ¤” [KnowledgeDecision] Analyzing message...
2025-12-31 01:46:31    Message: "ìê¸°ì•¼~~~íŠ¸ì™€ì´ì¦ˆ ë®¤ë¹„ í‹€ì–´ì¤˜~~~"
2025-12-31 01:46:32 âœ… [KnowledgeDecision] Decision: SKIP
2025-12-31 01:46:32    Duration: 821ms
2025-12-31 01:46:32    Tokens: 295
2025-12-31 01:46:32 âš¡ [ANIMA Chat] Knowledge search SKIPPED - casual conversation detected
2025-12-31 01:46:32    ğŸ’° Saved Pinecone API call + ~200-500ms latency
2025-12-31 01:46:32 ğŸ”¥ [ANIMA Chat] Building EMOTIONAL EMPATHY prompt for User Persona...
2025-12-31 01:46:32 ğŸ”¥ [EmotionalPrompt] Building for ê³ ì¤€í¬
2025-12-31 01:46:32 âœ… [EmotionalPrompt] Built: 19470 chars
2025-12-31 01:46:32 ğŸ“ [ANIMA Chat] System prompt built (19470 chars, 0 knowledge items)
2025-12-31 01:46:32 ğŸš€ [ANIMA Chat] Calling AI with Prompt Caching...
2025-12-31 01:46:32    Provider: openai
2025-12-31 01:46:32    Model: gpt-4o-mini
2025-12-31 01:46:32    History messages: 4
2025-12-31 01:46:32    System prompt length: 19470 chars
2025-12-31 01:46:32 ğŸ› ï¸ [Function Calling] Enabled tools: search_music, generate_chat_content, search_conversation_memory, search_youtube_video
2025-12-31 01:46:32    Persona type: User-created
2025-12-31 01:46:32    Has identity: true
2025-12-31 01:46:32    toolsEnabled: true
2025-12-31 01:46:32 ğŸ¤– [OpenAI] Calling API: {
2025-12-31 01:46:32   model: 'gpt-4o-mini',
2025-12-31 01:46:32   messageCount: 6,
2025-12-31 01:46:32   systemPromptLength: 19470,
2025-12-31 01:46:32   historyLength: 4,
2025-12-31 01:46:32   toolsEnabled: true
2025-12-31 01:46:32 }
2025-12-31 01:46:33 âœ… [OpenAI] Response received: {
2025-12-31 01:46:33   responseTime: '1755ms',
2025-12-31 01:46:33   tokens: { prompt: 9112, completion: 33, total: 9145 },
2025-12-31 01:46:33   messageLength: 0,
2025-12-31 01:46:33   finishReason: 'tool_calls',
2025-12-31 01:46:33   toolCalls: 1
2025-12-31 01:46:33 }
2025-12-31 01:46:33 ğŸ› ï¸ [Function Calling] AI requested 1 tool(s)
2025-12-31 01:46:33 ğŸ› ï¸ [Function Calling] Executing: search_youtube_video
2025-12-31 01:46:33    Args: {
2025-12-31 01:46:33   query: 'TWICE music video',
2025-12-31 01:46:33   reasoning: "User wants to watch TWICE's music video."
2025-12-31 01:46:33 }
2025-12-31 01:46:33 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-31 01:46:33 ğŸ¬ [Tool] search_youtube_video
2025-12-31 01:46:33    Query: TWICE music video
2025-12-31 01:46:33    Reasoning: User wants to watch TWICE's music video.
2025-12-31 01:46:33 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-31 01:46:34 âœ… [Tool] Video found: "TWICE &quot;THIS IS FOR&quot; M/V"
2025-12-31 01:46:34    Channel: JYP Entertainment
2025-12-31 01:46:34    Video ID: eHHQaoEW30Q
2025-12-31 01:46:34 âœ… [Function Calling] Result: {
2025-12-31 01:46:34   success: true,
2025-12-31 01:46:34   video: {
2025-12-31 01:46:34     videoId: 'eHHQaoEW30Q',
2025-12-31 01:46:34     title: 'TWICE &quot;THIS IS FOR&quot; M/V',
2025-12-31 01:46:34     channel: 'JYP Entertainment',
2025-12-31 01:46:34     thumbnail: 'https://i.ytimg.com/vi/eHHQaoEW30Q/hqdefault.jpg',
2025-12-31 01:46:34     description: 'TWICE "THIS IS FOR" M/V 4âƒ£Listen [THIS IS FOR]4âƒ£ https://TWICE.lnk.to/THISISFOR TWICE Official Shop: ...',
2025-12-31 01:46:34     publishedAt: '2025-07-11T03:59:06Z',
2025-12-31 01:46:34     url: 'https://www.youtube.com/watch?v=eHHQaoEW30Q',
2025-12-31 01:46:34     embedUrl: 'https://www.youtube.com/embed/eHHQaoEW30Q'
2025-12-31 01:46:34   },
2025-12-31 01:46:34   message: '"TWICE &quot;THIS IS FOR&quot; M/V" ì˜ìƒì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.'
2025-12-31 01:46:34 }
2025-12-31 01:46:34 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-31 01:46:34 ğŸ¬ [YouTube Search] AI found video!
2025-12-31 01:46:34    Title: "TWICE &quot;THIS IS FOR&quot; M/V"
2025-12-31 01:46:34    Channel: JYP Entertainment
2025-12-31 01:46:34    Video ID: eHHQaoEW30Q
2025-12-31 01:46:34 â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-31 01:46:34 âœ… [YouTube Search] Video data prepared for response
2025-12-31 01:46:34 ğŸ”„ [Function Calling] Re-calling AI with tool results...
2025-12-31 01:46:34 ğŸ¤– [OpenAI] Calling API: {
2025-12-31 01:46:34   model: 'gpt-4o-mini',
2025-12-31 01:46:34   messageCount: 8,
2025-12-31 01:46:34   systemPromptLength: 19470,
2025-12-31 01:46:34   historyLength: 6,
2025-12-31 01:46:34   toolsEnabled: false
2025-12-31 01:46:34 }
2025-12-31 01:46:35 âœ… [OpenAI] Response received: {
2025-12-31 01:46:35   responseTime: '1156ms',
2025-12-31 01:46:35   tokens: { prompt: 7565, completion: 37, total: 7602 },
2025-12-31 01:46:35   messageLength: 51,
2025-12-31 01:46:35   finishReason: 'stop',
2025-12-31 01:46:35   toolCalls: 0
2025-12-31 01:46:35 }
2025-12-31 01:46:35 âœ… [Function Calling] Final AI response generated
2025-12-31 01:46:35 âœ… [ANIMA Chat] AI response received (no caching)
2025-12-31 01:46:35    Response time: 1755ms
2025-12-31 01:46:35    Total tokens: 16747 (in: 16677, out: 70)
2025-12-31 01:46:35 ğŸ’¾ [ANIMA Chat] Both messages saved to history (sequential)
2025-12-31 01:46:35 ğŸ‰ [ANIMA Chat] Request completed in 4354ms
2025-12-31 01:46:35    Cost: $0.002544
2025-12-31 01:46:35 ğŸ’¾ [SessionManager] Message saved: session-1767111879097-ql9fo (user)
2025-12-31 01:46:35 ğŸ’¾ [SessionManager] Message saved: session-1767111879097-ql9fo (assistant)


